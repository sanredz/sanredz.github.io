<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compound Interest Calculator (+ Withdrawals)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #181c1f;
      color: #f2f2f2;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: 30px auto;
      background: #222836;
      padding: 2rem;
      border-radius: 22px;
      box-shadow: 0 8px 36px #000a;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      color: #6fffab;
      margin-bottom: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      font-size: 1rem;
      color: #cfd6e1;
      font-weight: 500;
    }
    input[type="number"] {
      width: 100%;
      padding: 0.7rem;
      border: none;
      border-radius: 8px;
      margin-bottom: 1.2rem;
      background: #181c27;
      color: #e8e8e8;
      font-size: 1.08rem;
    }
    input[type="number"]:focus {
      outline: 2px solid #6fffab;
    }
    button {
      width: 100%;
      background: #6fffab;
      color: #161616;
      font-weight: 700;
      padding: 0.9rem 0;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      letter-spacing: 1px;
      cursor: pointer;
      margin-bottom: 1.4rem;
      margin-top: 0.5rem;
      transition: background .2s;
    }
    button:hover {
      background: #38d882;
    }
    .results {
      background: #191f27;
      border-radius: 10px;
      padding: 1.1rem;
      margin-top: 1.6rem;
      font-size: 1.08rem;
      margin-bottom: 1.3rem;
    }
    .results span {
      color: #6fffab;
      font-weight: bold;
    }
    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
      background: #23293a;
      border-radius: 8px;
      overflow: hidden;
      font-size: 1rem;
    }
    th, td {
      padding: 0.7rem 0.3rem;
      text-align: right;
      border-bottom: 1px solid #333842;
    }
    th {
      background: #253047;
      color: #6fffab;
      font-size: 1.01rem;
    }
    tr:last-child td {
      border-bottom: none;
    }
    @media (max-width: 700px) {
      .container {
        margin: 0;
        border-radius: 0;
        min-height: 100vh;
        box-shadow: none;
        padding: 1rem;
      }
      table, th, td {
        font-size: 0.93rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Compound Interest Calculator</h1>
    <form id="calcForm">
      <label for="principal">Initial Investment ($):</label>
      <input type="number" id="principal" min="0" step="any" value="5000" required>

      <label for="rate">Annual Interest Rate (%):</label>
      <input type="number" id="rate" min="0" max="100" step="any" value="5" required>

      <label for="years">Years:</label>
      <input type="number" id="years" min="1" max="50" step="1" value="5" required>

      <label for="withdrawal">Monthly Withdrawal ($):</label>
      <input type="number" id="withdrawal" min="0" step="any" value="0">

      <button type="submit">Calculate</button>
    </form>

    <div class="results" id="results" style="display:none;"></div>
    <div id="breakdown"></div>
  </div>

  <script>
    function toMoney(x) {
      return "$" + Number(x).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
    }

    document.getElementById('calcForm').onsubmit = function(e) {
      e.preventDefault();
      const principal = parseFloat(document.getElementById('principal').value);
      const rate = parseFloat(document.getElementById('rate').value) / 100;
      const years = parseInt(document.getElementById('years').value);
      const withdrawal = parseFloat(document.getElementById('withdrawal').value) || 0;

      let balance = principal;
      let totalInterest = 0;
      let breakdown = [];
      let monthlyRate = rate / 12;
      let months = years * 12;

      for (let year = 0; year <= years; year++) {
        breakdown.push({year, interest: 0, accrued: totalInterest, balance});
      }

      for (let m = 1; m <= months; m++) {
        let interest = balance * monthlyRate;
        totalInterest += interest;
        balance += interest;

        // Monthly withdrawal at the *end* of the month
        balance -= withdrawal;
        if (balance < 0) {
          balance = 0;
        }

        // At the end of each year, push yearly snapshot
        if (m % 12 === 0 || m === months) {
          breakdown[Math.floor(m/12)].interest = (totalInterest - breakdown[Math.floor(m/12)-1]?.accrued || totalInterest).toFixed(2);
          breakdown[Math.floor(m/12)].accrued = totalInterest.toFixed(2);
          breakdown[Math.floor(m/12)].balance = balance < 0.01 ? 0 : balance.toFixed(2);
        }
      }

      let yearsActuallyLasted = months;
      if (balance === 0 && withdrawal > 0) {
        // Find last nonzero year
        for (let y = 1; y <= years; y++) {
          if (breakdown[y].balance == 0) {
            yearsActuallyLasted = y - 1 + ((12 - (months % 12))/12);
            break;
          }
        }
      }

      // Results summary
      document.getElementById('results').style.display = 'block';
      document.getElementById('results').innerHTML =
        `<div>
          <b>Future Value:</b> <span>${toMoney(breakdown[years].balance)}</span><br>
          <b>Total Interest Earned:</b> <span>${toMoney(totalInterest)}</span><br>
          <b>Years Lasted:</b> <span>${balance === 0 && withdrawal > 0 ? (yearsActuallyLasted).toFixed(2) : years}</span>
        </div>`;

      // Table breakdown
      let table = `
        <table>
          <tr>
            <th>Year</th>
            <th>Interest</th>
            <th>Accrued Interest</th>
            <th>Balance</th>
          </tr>
      `;
      for (let y = 0; y <= years; y++) {
        table += `<tr>
          <td>${y}</td>
          <td>${y === 0 ? '-' : toMoney(breakdown[y].interest)}</td>
          <td>${y === 0 ? '-' : toMoney(breakdown[y].accrued)}</td>
          <td>${toMoney(breakdown[y].balance)}</td>
        </tr>`;
        if (breakdown[y].balance == 0 && y !== 0) break;
      }
      table += "</table>";
      document.getElementById('breakdown').innerHTML = table;
    };

    // Trigger calculation on page load (default values)
    window.onload = () => {
      document.getElementById('calcForm').dispatchEvent(new Event('submit'));
    };
  </script>
</body>
</html>
